<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>å°åœ˜åº·äº’å‹•éŠæˆ²ï½œMission Roulette</title>
    <meta name="theme-color" content="#0b0b0b" />
    <style>
      :root {
        --bg: #0b0b0b;
        --card: #121315;
        --elev: #17191c;
        --fg: #f5f7fb;
        --muted: #a6adbb;
        --line: #23262b;
        --brand: #10b981;
        --brand-2: #059669;
        --warn: #f59e0b;
        --danger: #ef4444;
        --ok: #16a34a;
        --radius: 18px;
        --shadow: 0 18px 44px rgba(0, 0, 0, 0.35);
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        margin: 0;
        background: #0b0b0b;
        color: var(--fg);
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica,
          Arial;
      }
      .wrap {
        max-width: 1000px;
        margin: 0 auto;
        padding: 18px 16px 64px;
      }
      header {
        display: flex;
        gap: 12px;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 14px;
      }
      .brand {
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .brand h1 {
        font-size: 18px;
        margin: 0;
        letter-spacing: 0.5px;
      }
      .muted {
        color: var(--muted);
      }
      .row {
        display: grid;
        gap: 12px;
      }
      @media (min-width: 900px) {
        .row {
          grid-template-columns: 1.1fr 0.9fr;
        }
      }
      .card {
        background: linear-gradient(180deg, var(--card), #0f1012);
        border: 1px solid var(--line);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
      }
      .pad {
        padding: 14px;
      }
      .card h2 {
        margin: 0 0 10px;
        font-size: 16px;
      }
      .card h3 {
        margin: 0 0 8px;
        font-size: 15px;
      }
      .flex {
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .between {
        justify-content: space-between;
      }
      .stack {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .grid {
        display: grid;
        gap: 10px;
      }
      .grid-2 {
        grid-template-columns: 1fr 1fr;
      }
      .grid-3 {
        grid-template-columns: repeat(3, 1fr);
      }
      .chip {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid var(--line);
        background: #0e1012;
        font-size: 12px;
      }
      input,
      select {
        width: 100%;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid var(--line);
        background: #0e1114;
        color: var(--fg);
      }
      input::placeholder {
        color: #7b838f;
      }
      button {
        appearance: none;
        border: none;
        border-radius: 12px;
        padding: 10px 14px;
        background: var(--brand);
        color: #071109;
        font-weight: 600;
        cursor: pointer;
      }
      button.ghost {
        background: #0f1113;
        color: var(--fg);
        border: 1px solid var(--line);
      }
      button.warn {
        background: var(--warn);
        color: #1a1205;
      }
      button.danger {
        background: var(--danger);
      }
      button:disabled {
        opacity: 0.55;
        cursor: not-allowed;
      }
      .list {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }
      .pill {
        padding: 8px 12px;
        border: 1px dashed #2a2e34;
        border-radius: 999px;
      }
      .score {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }
      .score .item {
        background: #0d0f11;
        border: 1px solid var(--line);
        border-radius: 14px;
        padding: 10px 12px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .score .pts {
        font-weight: 700;
        color: #aee7ce;
      }
      .task {
        min-height: 120px;
        border: 1px dashed #2b3139;
        border-radius: 14px;
        padding: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        font-size: 18px;
        line-height: 1.5;
        background: radial-gradient(
          80% 80% at 50% 0%,
          rgba(16, 185, 129, 0.08),
          rgba(16, 185, 129, 0) 60%
        );
      }
      .task .cat {
        display: inline-block;
        margin-bottom: 8px;
        font-size: 12px;
        color: #9bd7bf;
      }
      .wheel {
        height: 42px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #2a2f36;
      }
      .dot.on {
        background: var(--brand);
      }
      .turn {
        font-weight: 700;
      }
      .footer {
        margin-top: 18px;
        font-size: 12px;
        color: var(--muted);
      }
      .divider {
        height: 1px;
        background: linear-gradient(90deg, transparent, #23262b, transparent);
        margin: 10px 0;
      }
      .timer {
        font-feature-settings: "tnum" 1, "lnum" 1;
        letter-spacing: 0.5px;
        font-weight: 800;
        font-size: 32px;
      }
      .blink {
        animation: blink 1s step-start infinite;
      }
      @keyframes blink {
        50% {
          opacity: 0.2;
        }
      }
      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <div class="brand">
          <svg
            width="26"
            height="26"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M12 3l2.5 5.1L20 9l-4 3.9.9 5.6L12 16.9 7.1 18.5 8 12.9 4 9l5.5-.9L12 3z"
              stroke="#a6adbb"
            />
          </svg>
          <div>
            <h1>Mission Rouletteï½œå°åœ˜åº·äº’å‹•éŠæˆ²</h1>
            <div class="muted">
              4â€“20äººï½œè¡Œå‹•/ç ´å†°/çŸ¥è­˜é¡Œï¼Œæ”¯æ´è¨ˆåˆ†ï¼‹å€’æ•¸è¨ˆæ™‚
            </div>
          </div>
        </div>
        <div class="wheel" id="turnWheel" aria-label="å›åˆæŒ‡ç¤º">
          <!-- dots injected by JS -->
        </div>
      </header>

      <div class="row">
        <!-- å·¦ï¼šéŠæˆ²å€åŸŸ -->
        <section class="card pad stack">
          <div class="flex between">
            <h2>å›åˆå€</h2>
            <div class="chip">
              <span>ç›®å‰è¼ªåˆ°ï¼š</span><span class="turn" id="turnWho">â€”</span>
            </div>
          </div>

          <div class="grid grid-3">
            <div class="stack">
              <h3>é¡Œå‹</h3>
              <div class="list" id="catList"></div>
            </div>
            <div class="stack">
              <h3>æ™‚é•·</h3>
              <select id="sec">
                <option value="30">30 ç§’</option>
                <option value="45">45 ç§’</option>
                <option value="60" selected>60 ç§’</option>
                <option value="90">90 ç§’</option>
              </select>
            </div>
            <div class="stack">
              <h3>å›åˆæ¨¡å¼</h3>
              <select id="mode">
                <option value="individual" selected>å€‹äººè¼ªæµ</option>
                <option value="team">éšŠä¼è¼ªæµï¼ˆå¹³å‡åˆ†é…ï¼‰</option>
              </select>
            </div>
          </div>

          <div class="divider"></div>

          <div class="task" id="taskBox" aria-live="polite">
            <div class="inner">
              <div class="cat" id="taskCat">é¸ä¸€å€‹é¡Œå‹ï¼ŒæŒ‰ã€ŒæŠ½é¡Œã€é–‹å§‹ï¼</div>
              <div id="taskText">â€”</div>
            </div>
          </div>

          <div class="flex between">
            <div class="flex" style="gap: 8px">
              <button id="btnDraw">æŠ½é¡Œ ğŸ²</button>
              <button class="ghost" id="btnPass" disabled>è·³é</button>
            </div>
            <div class="flex" style="gap: 8px">
              <div class="chip">
                <span class="muted">å€’æ•¸</span>
                <span class="timer" id="timer">00:00</span>
              </div>
              <button class="warn" id="btnStart" disabled>é–‹å§‹å€’æ•¸</button>
              <button class="ghost" id="btnStop" disabled>åœæ­¢</button>
              <button class="ok" id="btnDone" disabled>æˆåŠŸ +1 åˆ†</button>
            </div>
          </div>
        </section>

        <!-- å³ï¼šåå–® / è¨­å®š / è¨ˆåˆ† -->
        <aside class="card pad stack">
          <h2>ç©å®¶ / éšŠä¼</h2>
          <div class="grid grid-2">
            <input id="name" placeholder="è¼¸å…¥åç¨±ï¼ŒæŒ‰åŠ å…¥â€¦" />
            <div class="flex" style="gap: 8px">
              <button id="btnAdd">åŠ å…¥</button>
              <button class="ghost" id="btnClear">æ¸…ç©º</button>
            </div>
          </div>
          <div class="list" id="names"></div>
          <div class="divider"></div>
          <div class="flex between">
            <h3>è¨ˆåˆ†æ¿</h3>
            <button class="ghost" id="btnResetScore">åˆ†æ•¸æ­¸é›¶</button>
          </div>
          <div class="score" id="score"></div>
        </aside>
      </div>

      <div class="footer">
        æç¤ºï¼šé¡Œåº«å¯åœ¨ç¨‹å¼æœ€ä¸Šæ–¹
        <code>QUESTIONS</code> ç‰©ä»¶è‡ªè¡Œç·¨è¼¯ï¼›å¯ç”¨æ‰‹æ©Ÿèˆ‡é›»è…¦æ’­æ”¾ã€‚
      </div>
    </div>

    <script>
      /**********************
       * é¡Œåº«ï¼ˆå¯è‡ªè¡Œå¢åˆªæ”¹ï¼‰
       **********************/
      const QUESTIONS = {
        ICE: [
          "åˆ†äº«ä½ æ‰‹æ©Ÿç›¸ç°¿è£¡æœ€è¿‘çš„ä¸€å¼µç…§ç‰‡æ•…äº‹ï¼ˆä¸ç”¨å±•ç¤ºç•«é¢ï¼‰ã€‚",
          "ç”¨ 10 ç§’ä»‹ç´¹è‡ªå·±ç¾åœ¨æœ€æƒ³å­¸çš„æŠ€èƒ½ã€‚",
          "èªªå‡ºä½ åå­—çš„ç”±ä¾†æˆ–ä½ å¸Œæœ›è¢«æ€éº¼ç¨±å‘¼ã€‚",
          "ä»Šå¤©ä¾†é€™è£¡ä½ æœ€æœŸå¾…çš„ 1 ä»¶äº‹æ˜¯ï¼Ÿ",
          "æŠ½ 1 äººäº’ç›¸èª‡è®šå°æ–¹ 1 å¥ï¼ˆå…·é«”ä¸€é»ï¼‰ã€‚",
          "ç”¨ 3 å€‹å½¢å®¹è©æè¿°æ­¤åˆ»çš„å¿ƒæƒ…ã€‚",
          "è‹¥æœ‰è¶…èƒ½åŠ›ï¼Œä½ æƒ³è¦åœ¨åœ˜éšŠæ‰®æ¼”ä»€éº¼è§’è‰²ï¼Ÿ",
          "èªªå‡ºä½ æœ€è¿‘ä¸€æ¬¡ã€å•Šå“ˆï¼ã€çš„å­¸ç¿’ç¬é–“ã€‚",
          "åˆ†äº«ä¸€å€‹ä½ æœ€å¸¸ç”¨ä½†åˆ¥äººå¯èƒ½ä¸çŸ¥é“çš„å°æŠ€å·§ã€‚",
          "ä»Šå¤©ä½ å¯ä»¥ç‚ºä»–äººåšçš„ä¸€ä»¶å°äº‹æ˜¯ä»€éº¼ï¼Ÿ",
        ],
        ACTION: [
          "ä¸ç™¼å‡ºè²éŸ³ï¼Œè¡¨æ¼”ã€åæ·é‹è¢«ç¡è‘—çš„äººå£“åˆ°ã€è®“å¤§å®¶çŒœã€‚",
          "æŠŠç¾å ´ç‰©å“ç–Šæˆè‡³å°‘ 3 å±¤å¡”ï¼Œ 30 ç§’å…§å®Œæˆã€‚",
          "å³æ‰‹ç•«åœˆå·¦æ‰‹ç•«æ–¹å½¢ï¼Œç¶­æŒ 15 ç§’ã€‚",
          "å’Œæ—é‚Šçš„äººå®Œæˆä¸€å€‹åŒæ­¥æ“ŠæŒçš„ç¯€å¥ï¼ˆè‡³å°‘ 8 æ‹ï¼‰ã€‚",
          "ç¹å ´èµ°ä¸€åœˆä¸¦è·Ÿ 2 å€‹äººçœ¼ç¥æ‰“æ‹›å‘¼ï¼‹é»é ­ã€‚",
          "ç”¨èº«é«”æ¯”å‡ºã€OKã€ã€ã€æ„›å¿ƒã€ã€ã€é–ƒé›»ã€ä¸‰å€‹åœ–æ¨£ã€‚",
          "æ‰¾ä¸€åå¤¥ä¼´ä¸€èµ·å®Œæˆ 3 ç¨®ä¸åŒçš„æ“ŠæŒå§¿å‹¢ã€‚",
          "æŠŠè‡ªå·±çš„ç”Ÿæ—¥ç”¨ã€æ‰‹å‹¢ã€æ¼”å‡ºï¼Œè®“å¤§å®¶çŒœæœˆä»½èˆ‡æ—¥æœŸã€‚",
          "éš¨æ©Ÿé¸ç‰©ç•¶éº¥å…‹é¢¨ï¼Œä¾†ä¸€æ®µ 10 ç§’ä¸»æŒä¸²å ´ã€‚",
          "åœ¨åº§ä½ä¸Šåš 5 ä¸‹ä¼¸å±•å‹•ä½œï¼ˆé ¸ã€è‚©ã€èƒŒã€æ‰‹è…•ã€è…°ï¼‰ã€‚",
        ],
        QUIZ: [
          "å¿«å•å¿«ç­”ï¼šå°ç£çš„é¦–éƒ½æ˜¯ï¼Ÿï¼ˆå°åŒ—ï¼‰",
          "è«‹èªªå‡º 1 å€‹å¸¸è¦‹çš„å†ç”Ÿèƒ½æºç¨®é¡ã€‚",
          "é¸æ“‡é¡Œï¼šRGB ä¸‰åŸè‰²çš„ã€Bã€ä»£è¡¨ï¼Ÿ A. Black B. Blue C. Bright",
          "æ•¸å­¸å¿ƒç®—ï¼š15Ã—4âˆ’18ï¼ï¼Ÿï¼ˆ42ï¼‰",
          "åœ˜é«”åˆä½œé¡Œï¼šèªªå‡º 3 å€‹é›²ç«¯å”ä½œå·¥å…·ï¼ˆä¸é™å“ç‰Œï¼‰ã€‚",
          "å¸¸è­˜ï¼šæˆäººæ¨™æº–ä¸€é›™ç­·å­é•·åº¦ç´„ 23â€“24 å…¬åˆ†ï¼ˆå°/éŒ¯ï¼Ÿï¼‰",
          "è‹±æ–‡å­—æ¯ç¬¬ 20 å€‹å­—æ¯æ˜¯ï¼Ÿï¼ˆTï¼‰",
          "ç§‘æŠ€ï¼šNFC çš„å®Œæ•´è‹±æ–‡æ˜¯ï¼Ÿï¼ˆNear Field Communicationï¼‰",
          "è…¦ç­‹æ€¥è½‰å½ï¼šä»€éº¼æ±è¥¿è¶Šæ´—è¶Šé«’ï¼Ÿï¼ˆæ°´ï¼‰",
          "åœ°ç†ï¼šæ—¥æœˆæ½­ä½æ–¼å°ç£å“ªå€‹ç¸£å¸‚ï¼Ÿï¼ˆå—æŠ•ï¼‰",
        ],
        CREATIVE: [
          "æŠŠã€ä»Šå¤©çš„æ´»å‹•ã€ç”¨ 1 å¥å»£å‘Šæ¨™èªé‡æ–°å‘½åã€‚",
          "æŠŠä½ å·¦æ‰‹é‚Šçš„ç‰©å“æ”¹é€ æˆä¸€å€‹å…¨æ–°ç”¢å“ï¼Œèªªæ˜ç”¨é€”ã€‚",
          "å³èˆˆï¼šæŠŠã€æ—©èµ·ã€å’Œã€å¤œè²“ã€èåˆæˆä¸€ç¨®æ–°ç”Ÿæ´»æ–¹å¼ã€‚",
          "æ“²éª°å­å¼ç™¼æƒ³ï¼šç”¨ã€é£Ÿç‰©ã€ã€äº¤é€šã€ã€å­¸ç¿’ã€ä»»é¸å…©è©æ§‹æƒ³æœå‹™ã€‚",
          "æŠŠä½ æœ€ç†Ÿæ‚‰çš„ä¸€ä»¶äº‹æ•™çµ¦ 5 æ­²å°å­©ï¼Œ10 ç§’æ•™å­¸ã€‚",
          "è¯æƒ³ï¼šã€é‘°åŒ™ã€Ã—ã€å›æ†¶ã€â†’ æƒ³ä¸€å€‹æœå‹™åç¨±èˆ‡ä¸€å¥è©±èªªæ˜ã€‚",
          "æŠŠã€ç­‰å¾…æ’éšŠã€è®Šæˆæœ‰è¶£çš„ 1 åˆ†é˜æ´»å‹•ã€‚",
          "ç•«é¢æè¿°ï¼šé–‰çœ¼ 5 ç§’ï¼Œèªªå‡ºä½ å‰›æƒ³åˆ°çš„ç¬¬ä¸€å€‹ç•«é¢ã€‚",
          "æŠŠã€å¤±æ•—ã€æ›æˆä¸€å€‹æ›´ä¸­æ€§çš„è©ï¼Œä¸¦çµ¦å‡ºå®šç¾©ã€‚",
          "æŠŠä»Šå¤©å­¸åˆ°çš„ 1 ä»¶äº‹è®Šæˆä¸€å€‹ç¤¾ç¾¤æŒ‘æˆ° hashtagã€‚",
        ],
      };

      const CATS = [
        { id: "ICE", name: "ç ´å†° ICE" },
        { id: "ACTION", name: "è¡Œå‹• ACTION" },
        { id: "QUIZ", name: "çŸ¥è­˜ QUIZ" },
        { id: "CREATIVE", name: "å‰µæ„ CREATIVE" },
      ];

      /**********************
       * ç‹€æ…‹
       **********************/
      let players = []; // [{name, score}]
      let turnIndex = 0; // æŒ‡å‘ç›®å‰è¼ªåˆ°çš„äºº/éšŠä¼
      let teams = []; // [[idx, idx], ...] è‹¥ team æ¨¡å¼å•Ÿç”¨
      let currentCat = null;
      let timerId = null,
        left = 0;

      /**********************
       * DOM åƒç…§
       **********************/
      const el = (id) => document.getElementById(id);
      const $names = el("names");
      const $score = el("score");
      const $turnWho = el("turnWho");
      const $taskBox = el("taskBox");
      const $taskCat = el("taskCat");
      const $taskText = el("taskText");
      const $timer = el("timer");
      const $turnWheel = el("turnWheel");

      /**********************
       * å·¥å…·
       **********************/
      const fmt = (s) => (s < 10 ? "0" + s : s);
      function setTimer(sec) {
        left = sec;
        drawTimer();
      }
      function drawTimer() {
        const m = Math.floor(left / 60),
          s = left % 60;
        $timer.textContent = `${fmt(m)}:${fmt(s)}`;
      }
      function pick(arr) {
        return arr[Math.floor(Math.random() * arr.length)];
      }
      function shuffle(a) {
        for (let i = a.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
      }

      /**********************
       * é¡Œå‹ UI
       **********************/
      function drawCats() {
        const box = document.getElementById("catList");
        box.innerHTML = "";
        CATS.forEach((c) => {
          const b = document.createElement("button");
          b.className = "ghost";
          b.textContent = c.name;
          b.style.padding = "8px 12px";
          b.onclick = () => {
            currentCat = c.id;
            [...box.children].forEach((x) => (x.style.outline = "none"));
            b.style.outline = "2px solid var(--brand)";
          };
          box.appendChild(b);
        });
      }

      /**********************
       * ç©å®¶åå–®èˆ‡è¨ˆåˆ†
       **********************/
      function drawPlayers() {
        $names.innerHTML = "";
        players.forEach((p, i) => {
          const chip = document.createElement("div");
          chip.className = "chip";
          chip.innerHTML = `<strong>${p.name}</strong>`;
          const rm = document.createElement("button");
          rm.textContent = "Ã—";
          rm.className = "ghost";
          rm.style.padding = "4px 8px";
          rm.onclick = () => {
            players.splice(i, 1);
            if (turnIndex >= players.length) turnIndex = 0;
            drawAll();
          };
          chip.appendChild(rm);
          $names.appendChild(chip);
        });
        drawScore();
        drawTurnWheel();
        drawTurnWho();
      }
      function drawScore() {
        $score.innerHTML = "";
        players.forEach((p, i) => {
          const it = document.createElement("div");
          it.className = "item";
          it.innerHTML = `<span>${p.name}</span> <span class="pill">åˆ†æ•¸ <b class="pts">${p.score}</b></span>`;
          const plus = document.createElement("button");
          plus.textContent = "+1";
          plus.onclick = () => {
            p.score++;
            drawScore();
          };
          const minus = document.createElement("button");
          minus.textContent = "-1";
          minus.className = "ghost";
          minus.onclick = () => {
            p.score = Math.max(0, p.score - 1);
            drawScore();
          };
          it.appendChild(plus);
          it.appendChild(minus);
          $score.appendChild(it);
        });
      }

      function drawTurnWheel() {
        $turnWheel.innerHTML = "";
        for (let i = 0; i < Math.min(players.length, 12); i++) {
          const d = document.createElement("div");
          d.className = "dot" + (i === turnIndex ? " on" : "");
          $turnWheel.appendChild(d);
        }
      }
      function drawTurnWho() {
        if (players.length === 0) {
          $turnWho.textContent = "â€”";
          return;
        }
        const who = getCurrentEntity();
        $turnWho.textContent = Array.isArray(who)
          ? who.map((i) => players[i].name).join(" ï¼† ")
          : players[who].name;
      }

      /**********************
       * éšŠä¼æ¨¡å¼
       **********************/
      function buildTeams() {
        const N = players.length;
        if (N < 2) {
          teams = [];
          return;
        }
        const idx = shuffle([...Array(N).keys()]);
        const size = Math.max(2, Math.min(4, Math.round(N / Math.ceil(N / 3))));
        teams = [];
        for (let i = 0; i < N; i += size) {
          teams.push(idx.slice(i, i + size));
        }
      }
      function getCurrentEntity() {
        const m = document.getElementById("mode").value;
        if (m === "team") {
          if (teams.length === 0) buildTeams();
          return teams[turnIndex % teams.length];
        }
        return turnIndex % players.length;
      }
      function nextTurn() {
        if (players.length === 0) return;
        const m = document.getElementById("mode").value;
        if (m === "team")
          turnIndex = (turnIndex + 1) % Math.max(1, teams.length);
        else turnIndex = (turnIndex + 1) % players.length;
        drawTurnWheel();
        drawTurnWho();
      }

      /**********************
       * æŠ½é¡Œ + å€’æ•¸
       **********************/
      function drawTask() {
        const cat = currentCat || pick(CATS).id;
        const q = pick(QUESTIONS[cat]);
        $taskCat.textContent = CATS.find((c) => c.id === cat).name;
        $taskText.textContent = q;
        document.getElementById("btnPass").disabled = false;
        document.getElementById("btnStart").disabled = false;
        document.getElementById("btnDone").disabled = true;
      }
      function startTimer() {
        if (timerId) return;
        const sec = parseInt(document.getElementById("sec").value, 10);
        setTimer(sec);
        toggleTimerButtons(true);
        timerId = setInterval(() => {
          left--;
          drawTimer();
          if (left <= 0) {
            stopTimer();
            flash();
          }
        }, 1000);
      }
      function stopTimer() {
        if (timerId) {
          clearInterval(timerId);
          timerId = null;
        }
        toggleTimerButtons(false);
      }
      function toggleTimerButtons(running) {
        document.getElementById("btnStart").disabled = running;
        document.getElementById("btnStop").disabled = !running;
        document.getElementById("btnDone").disabled = running;
      }
      function flash() {
        $timer.classList.add("blink");
        setTimeout(() => {
          $timer.classList.remove("blink");
        }, 4000);
      }

      /**********************
       * åˆå§‹åŒ–èˆ‡äº‹ä»¶
       **********************/
      function drawAll() {
        drawPlayers();
        drawTurnWho();
      }

      function init() {
        drawCats();
        drawAll();
        setTimer(60);

        document.getElementById("btnAdd").onclick = () => {
          const v = document.getElementById("name").value.trim();
          if (!v) return;
          players.push({ name: v, score: 0 });
          document.getElementById("name").value = "";
          drawAll();
        };
        document.getElementById("btnClear").onclick = () => {
          players = [];
          turnIndex = 0;
          teams = [];
          drawAll();
        };
        document.getElementById("btnResetScore").onclick = () => {
          players.forEach((p) => (p.score = 0));
          drawScore();
        };

        document.getElementById("mode").onchange = (e) => {
          if (e.target.value === "team") buildTeams();
          else teams = [];
          drawTurnWho();
        };

        document.getElementById("btnDraw").onclick = () => {
          drawTask();
        };
        document.getElementById("btnPass").onclick = () => {
          drawTask();
        };
        document.getElementById("btnStart").onclick = () => {
          startTimer();
        };
        document.getElementById("btnStop").onclick = () => {
          stopTimer();
        };
        document.getElementById("btnDone").onclick = () => {
          // ç•¶å‰äºº/éšŠä¼ +1 åˆ†
          if (players.length === 0) return;
          const who = getCurrentEntity();
          if (Array.isArray(who)) who.forEach((i) => players[i].score++);
          else players[who].score++;
          drawScore();
          nextTurn();
          // è‡ªå‹•ä¸‹ä¸€é¡Œ
          drawTask();
        };

        // Enter å¿«æ·åŠ å…¥
        document.getElementById("name").addEventListener("keydown", (e) => {
          if (e.key === "Enter") document.getElementById("btnAdd").click();
        });
      }

      init();
    </script>
  </body>
</html>
